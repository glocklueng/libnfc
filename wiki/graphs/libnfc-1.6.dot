digraph nfc_transceive {
    fontname="Bitstream Vera Sans";
    fontsize=12;

    edge [fontname="Bitstream Vera Sans", fontsize=8];
    node [fontname="Bitstream Vera Sans", fontsize=12];

    subgraph {
	node [shape=plaintext];
	library -> driver -> interface -> chip;
    }

    libnfc	[shape=house];
    PN532	[shape=invhouse];

    {
	edge [style=dotted];
	PN53x:w -> UART:n;
	UART:s -> PN532:w;
	libnfc:e -> PCSC:n;
	PCSC:s -> PN532:e;
    }

    {
	rank=same;
	libnfc;
	library;
    }

    {
	rank=same;
	PCSC;
	PN53x;
	driver;
    }

    {
	rank=same;
	USB;
	UART;
	interface;
    }

    {
	rank=same
	PN532;
	chip;
    }

    // Send message
    edge [color="#ada7c8"];
    libnfc -> PN53x	[taillabel="1"];
    PN53x -> USB	[taillabel="2"];
    USB -> PN532	[taillabel="3"];

    // Receive ACK/NACK
    edge [color="#887da3"];
    PN532 -> USB	[taillabel="4"];
    USB -> PN53x	[taillabel="5"];
    PN53x -> libnfc	[taillabel="6.2", style=dashed]; // fail

    // Receive response
    edge [color="#625b81"];
    PN53x -> USB	[taillabel="6.1"]; // ok
    PN532 -> USB	[taillabel="7"];
    USB -> PN53x	[taillabel="8"];

    // Send ACK
    edge [color="#494066"]
    PN53x -> USB	[taillabel="9"];
    USB -> PN532	[taillabel="10"];
    PN53x -> libnfc	[taillabel="11"];

    label="Expected nfc_transceive() call path for libnfc-1.6.";
}
